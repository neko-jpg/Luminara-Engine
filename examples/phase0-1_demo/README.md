# 🎮 Luminara Engine - Ultimate Demo

## 究極のデモ：物理シミュレーションとインタラクティブコントロール

このデモは、Luminara Engineの全機能を統合した包括的なショーケースです。

---

## 🚀 実行方法

### Windows + WSL (推奨)

#### 方法1: インタラクティブメニュー (最も簡単)
```cmd
cd examples\ultimate_demo
menu.bat
```

メニューから以下のオプションを選択できます：
- [1] デモ実行 (Release)
- [2] デモ実行 (Debug)
- [3] ビルドのみ (Release)
- [4] ビルドのみ (Debug)
- [5] クリーンビルド
- [6] 依存関係チェック
- [7] ログ表示
- [8] テスト実行
- [9] コントロールヘルプ

#### 方法2: 直接実行
```cmd
cd examples\ultimate_demo
run_wsl.bat
```

#### 方法3: WSLコマンド直接実行
```cmd
wsl -d ubuntu bash -c "cd /mnt/c/dev/Luminara-Engine/examples/ultimate_demo && /home/arat2/.cargo/bin/cargo run --release"
```

### Linux / WSL内部
```bash
cd examples/ultimate_demo
cargo run --release
```

---

## � デモ内コントロール

### カメラ操作
- **W/A/S/D**: 前進/左/後退/右
- **マウス**: 視点移動 (FPS スタイル)
- **Shift**: スプリントモード (3倍速)
- **Space**: 上昇
- **Ctrl**: 下降

### デモ機能
- **G**: デバッグギズモの表示/非表示
- **P**: 物理シミュレーションの一時停止/再開
- **T**: カメラ位置にランダムなオブジェクトを生成
- **C**: 動的に生成されたオブジェクトをクリア
- **R**: カメラ位置をリセット
- **F**: ワイヤーフレームモードの切り替え
- **H**: コマンドメニューの表示/非表示

### システム
- **Esc**: デモ終了

---

## 📊 デモの特徴

### シーン構成

1. **球体タワー** (左側): 15個の金属球が積み重なったタワー - 劇的に崩壊します
2. **立方体ピラミッド** (中央): 30個の立方体で構成されたピラミッド
3. **発光球体** (周囲): 5個の光るエネルギーコアが円形に配置
4. **地面と壁**: 物理シミュレーションの境界
5. **動的照明**: リアルタイムシャドウ付きの指向性ライト

### 視覚機能

- **PBRマテリアル**: 各オブジェクトは独自のメタリック/ラフネス値を持つ
- **リアルタイムシャドウ**: 指向性ライトが動的な影を投影
- **デバッグ可視化**: ギズモで物理エンジンの内部を表示
  - 速度ベクトル (緑の線)
  - 衝突法線 (赤の線)
  - BVHバウンディングボックス (シアンのワイヤーフレーム)
  - ローカル座標軸 (RGB = XYZ)
- **スムーズカメラ**: 慣性ベースの移動
- **パフォーマンス統計**: リアルタイムFPS、エンティティ数

---

## 🎯 デモの見どころ

### 物理カオス
1. **初期崩壊**: 球体タワーが最初に崩れ、連鎖反応を引き起こす
2. **ピラミッド破壊**: 立方体が転がり落ちる
3. **創発的挙動**: オブジェクトが予測不可能な方法で相互作用
4. **安定した静止**: 最終的にすべてが安定した構成に落ち着く

### デバッグ可視化 (Gキーを押す)
- **緑の速度ベクトル**: オブジェクトの移動方向と速度を表示
- **赤の衝突法線**: 接触点に表示
- **シアンのBVHボックス**: 空間加速構造を表示
- **RGB軸**: 各オブジェクトのローカル座標系を示す

---

## 🔧 カスタマイズ

### オブジェクトを追加生成
Tキーを押してカメラ位置にオブジェクトを生成。試してみてください：
- 異なる高さに飛んで生成
- 移動中に生成
- タワーや構造物を作成

### 物理パラメータの変更
`src/main.rs`を編集して以下を変更：
- 重力の強さ
- オブジェクトの質量
- マテリアルプロパティ (摩擦、反発)
- 生成パターン

### ビジュアルの調整
以下を調整：
- PBRマテリアル値 (メタリック、ラフネス)
- ライトの強度と色
- シャドウ品質
- カメラFOVと速度

---

## 📈 パフォーマンス指標

中程度のシステム (Ryzen 5 3600, GTX 1660) での測定値：
- **フレームタイム**: ~16ms (60 FPS)
- **物理ステップ**: ~2ms
- **レンダリング時間**: ~12ms
- **ギズモレンダリング**: ~1ms (有効時)
- **メモリ使用量**: ~200MB

---

## � トラブルシューティング

### WSL関連

#### WSLが見つからない
```cmd
# WSLのインストール状態を確認
wsl -l -v

# Ubuntuがない場合はインストール
wsl --install -d Ubuntu
```

#### Cargoが見つからない
```bash
# WSL内でRustをインストール
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
source $HOME/.cargo/env
```

#### パスが正しくない
```cmd
# プロジェクトパスを確認
wsl -d ubuntu bash -c "ls /mnt/c/dev/Luminara-Engine/examples/ultimate_demo"

# Cargoパスを確認
wsl -d ubuntu bash -c "ls /home/arat2/.cargo/bin/cargo"
```

### パフォーマンス関連

#### FPSが低い
- ギズモを無効化 (Gキーを押す)
- 設定でシャドウ品質を下げる
- Releaseモードで実行 (`--release`)

#### 物理が不安定
- 生成レートを下げる
- 物理サブステップを増やす
- トランスフォームのNaN値をチェック

#### レンダリングの問題
- グラフィックドライバを更新
- wgpuバックエンドを確認 (Vulkan/DX12/Metal)
- シェーダーコンパイルを検証

---

## 📝 技術詳細

### アーキテクチャ

このデモは以下を統合しています：

1. **ECSコア** (`luminara_core`)
   - World, Entity, Component, System
   - プラグインシステム
   - スケジューリング

2. **レンダリング** (`luminara_render`)
   - wgpuベースのモダンなグラフィックスパイプライン
   - PBRシェーディング
   - シャドウマッピング
   - メッシュとテクスチャ

3. **物理** (`luminara_physics`)
   - Rapier統合 (3D)
   - 衝突検出
   - リジッドボディダイナミクス

4. **数学** (`luminara_math`)
   - PGA (射影幾何代数)
   - モーター (回転と平行移動)
   - 正確な述語

5. **入力** (`luminara_input`)
   - キーボード、マウス
   - ゲームパッドサポート

6. **シーン** (`luminara_scene`)
   - トランスフォーム階層
   - シリアライゼーション (RON/JSON)

---

## 🎓 学習ポイント

このデモから学べること：

1. **ECSアーキテクチャ**: エンティティ、コンポーネント、システムの連携
2. **物理統合**: Rapierをエンジンに接続する方法
3. **レンダリングパイプライン**: PBRマテリアル、ライティング、シャドウ
4. **デバッグツール**: 開発者フレンドリーな可視化の構築
5. **パフォーマンス**: 60 FPSで100以上のオブジェクトを処理
6. **クロスプラットフォーム**: Windows + WSLでの開発

---

## 🎉 まとめ

このデモは、本格的なゲームエンジン基盤を表しています。見える全ての機能—ECSコアから物理シミュレーション、デバッグツールまで—は、パフォーマンス、正確性、開発者体験を念頭に置いてゼロから構築されました。

**Phase 0-1 完了。Phase 2-3 (スクリプティング、エディタ、ネットワーキング) が待っています！**

---

## 📞 サポート

問題が発生した場合：

1. `menu.bat`の「依存関係チェック」を実行
2. `error.log`を確認
3. WSLとCargoのパスを検証
4. Releaseモードでビルドを試す

---

## 📜 ライセンス

Luminara Engine の一部として提供されています。

Built with ❤️ and Rust 🦀
